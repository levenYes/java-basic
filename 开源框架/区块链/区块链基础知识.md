# 区块链基础知识
区块链在本质上就是一种记账方法，通过一种软件，暂且简称为区块链客户端。通常，我们把运行中的客户端软件称为“节点”。

有什么事只要招呼一声，立马消息就会传遍整个网络节点。这点方式跟新闻转发差不多，不需要依靠某一个人，大家就能互通消息了，在区块链软件的结构中，这种互相通信的功能称为“网络路由”。

在这个网络中，每个节点都维护着自己的一个账本，账本中记录着网络中发生的一笔笔账务。具体是什么样的账务呢？这得看具体是什么样的功能网络。区块链技术术语一种方法，可以用来实现各种不同的业务功能。

网络中的节点是独立记账的，可是记账的内容要保持彼此一致。所用的方法就是设定一个游戏规则，通过这个规则选出一个记账的节点，就如上例中的掷骰子。在区块链系统中，这个所谓的“掷骰子”称为“共识算法”，就是一种大家都遵守的筛选方案，我们可以先这么简单地理解。选出一个节点后，则一段时间内的账务数据都以这个节点记录的为准，这个节点记录后会把数据广播出去，告诉其他的节点，其他节点只需要通过网络来接收新的数据，接收后各自根据自己现有的账本验证一下能不能接得上，有没有不匹配和不规范的，如果都符合要求，就存储到自己的账本中。

区块链的技术理念，其实就是大家共同来参与记账，通过一种规则不断地选出账务打包者，其他节点接收验证，并且每个用户都有一对密钥表示自己，通过脚本系统的功能实现在公共网络中定向发送有价值的数据。

## 一般的工作流程
整个数据的发送过程其实还是很简单的，数据发送出去后，会被打包进区块，然后广播出去给所有的节点确认，确认没有问题后就写入到各自的本地区块链账本中，当网络中的大多数节点都确认写入后，这个转账过程就算是完成了。

这个工作流程图是有代表性的，其他各种系统都是在这个基础上进行衍生和扩展。比如有些会增加身份认证功能，以确保只有符合身份验证的用户才能发送数据；有些则扩展交易数据的表达能力，不但能用来表示一般的交易转账，还能表示更复杂的商业逻辑。各种应用很多，但是万变不离其宗。

区块链的技术其实就是围绕如何保持数据的一致、如何让这个公共账本的数据不被篡改来展开的。

## 区块链技术栈
与传统的记录格式不同的是，区块链是将产生的数据按照一定的时间间隔，分成一个个的数据块记录，然后再根据数据块的先后关系串联起来，也就是所谓的区块链了。按照这种规则，沿着时间线不断增加新的区块，就好像是时光记录仪一样，记录下发生的每一笔操作。

最基本的技术组合包括：共识机制、密码算法、网络路由、脚本系统和区块链脚本。

#### 1.区块链账本
以比特币来说，大约是每10分钟产生一个区块，区块中主要包含了交易事务数据以及区块的摘要信息。

区块数据在逻辑上分成了区块头和区块体，每个区块头中通过梅克尔根关联了区块中众多的交易事务，而每个区块之间通过区块头哈希值（区块头哈希值就是一个区块的身份证号）串联起来。

在区块链系统中，一个节点产生的数据或者更改的数据要发送到网络中的其他节点接受验证，而其他节点是不会验证通过一个被篡改的数据的，因为跟自己的本地区块链账本数据匹配不起来，这也是区块链数据不可篡改的一个很重要的技术设计。

#### 2.共识机制
共识算法其实就是一个规则，每个节点都按照这个规则去确认各自的数据。

在区块链系统中，存在着多种这样的筛选方案，比如PoW（Proof of Work，工作量证明）等等。区块链系统就是通过这种筛选算法或者说共识算法来使得网络中各个节点的账本数据达成一致的。

#### 3.密码算法
区块之间的连接，往往都不是靠数据地址来关联的，而是靠一种叫作哈希值的数据来关联的。什么叫哈希值？这是通过密码算法中的哈希算法计算得出的。哈希算法可以通过对一段数据计算后得出一段摘要字符串，这种摘要字符串与原始数据是唯一对应的。

因为如果对原始数据进行修改，哪怕只是一点点修改，那么计算出来的哈希值都会发生完全的变化。区块链账本对每个区块都会计算出一个哈希值，称为区块哈希，通过区块哈希来串联区块。

这有一个很好的作用就是，如果有人篡改了中间的某一个区块数据，那么后面的区块就都要进行修改，这个时候并不是简单地修改一下后面区块的地址指向就能结束的，由于后面的区块是通过区块哈希来指向的，只要前面的区块发生变动，这个区块哈希就无效了，就指不到正确的区块了。

对一个区块中所有的事务进行哈希计算后，可以得出一组事务哈希，再通过对这些事务哈希进行加工处理，最终会得出一棵哈希树的数据结构。哈希树的顶部就是树根，称为“梅克尔根”。通过这个梅克尔根就可以将整个区块中的事务约束起来，只要区块中的事务有任何改变，梅克尔根就会发生变化，利用这一点，可以确保区块数据的完整性。

#### 4.脚本系统
脚本系统的区块链中是一个相对抽象的概念，也是极其重要的一个功能，可以说区块链系统之所以能形成一个有价值的网络，依靠的就是脚本系统，它就像是发动机一样，驱动着区块链系统不断进行着各种数据的收发。

所谓脚本，就是指一组程序规则。脚本系统使得在区块链中可以实现各种各样的业务功能。通过脚本系统，大家可以使用区块链来记录各种各样的数据，比如订单、众筹账户、物流信息、供应链信息等，这些数据一旦可以记录到区块链上，那么区块链的优点就能够被充分地发挥出来。

#### 5.网络路由
在分布式的网络结构中，不存在一个指定的服务器，大家没法通过一个服务器来直接交换彼此的身份信息，就只能依靠彼此联系并传播信息。在区块链系统中，这个功能一般会定义成一种协议，称为“节点发现协议”。

除了要发现节点外，更重要的一个功能就是同步数据。节点要保持自己的账本数据是最新的，就必须要时时更新自己的数据。

网络路由可以说是区块链系统中的触角，通过大量的触角将每个节点连入网络，从而形成一个功能强大的区块链共识网络。
